harnessApiVersion: '1.0'
type: SHELL_SCRIPT
scriptString: |+
  pwd
  echo "testing vault"
  export VAULT_ADDR=https://kmaas.nbs-shared-security-test.aws.nbscloud.co.uk/
  export VAULT_SKIP_VERIFY=true
  export VAULT_NAMESPACE=aws/nbs-shared-cbj-dev
  export SA_TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
  export VAULT_TOKEN=$(./vault write auth/kubernetes-harness-nbs-shared-cbj-dev/login role=cicd -path=/kubernetes-harness-nbs-shared-cbj-dev jwt="$SA_TOKEN" -format="json" | /tmp/jq-linux64 -r '.auth.client_token')

  export secret="$(./vault kv get -field=${vault_secret_key} ${vault_secret_path})"






scriptType: BASH
secretOutputVars: secret
timeoutMillis: 10
variables:
- description: eg, secrets/creds
  name: vault_secret_path
  value: secrets/artifactory
- description: eg. keyname
  name: vault_secret_key
  value: kaizen-ci
